<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detectified</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@100;400;700&display=swap" rel="stylesheet" />
  <style>
    /* Base layout */
    body {
      margin: 0;
      font-family: "Exo 2", sans-serif;
      background: url("https://i.imgur.com/ol1MfVj.gif") no-repeat center center fixed;
      background-size: cover;
      color: black;
      cursor: url('https://i.imgur.com/4b7KkzM.png') 16 16, auto;
    }
    .fluidjumbo {
      background-color: #38e3be2f;
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 25px;
      text-align: center;
      margin: 20px auto;
      max-width: 90%;
    }
    .cards-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      justify-items: center;
      padding: 10px;
      margin-bottom: 220px; /* space for fixed music card */
    }
    .card {
      background: linear-gradient(rgba(229, 235, 234, 0.5), rgba(143, 143, 143, 0.5));
      border: 3px inset #ffffff9a;
      border-radius: 25px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      padding: 15px;
      box-shadow: 0 0 30px #38e3be;
      backdrop-filter: blur(5px);
      position: relative;
    }
    .img-wrap { display: inline-block; transition: transform 0.4s ease; }
    .img-wrap:hover { transform: rotate(360deg) scale(1.1); } /* keep hover even in no-animations mode */
    .card img { width: 200px; height: 200px; border-radius: 30px; display: block; }

    button {
      display: block;
      margin: 8px auto;
      border-radius: 25px;
      padding: 8px 20px;
      border: 2px solid #38e3be;
      background: rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: 0.3s ease;
    }
    button:hover { transform: scale(1.05); box-shadow: 0 0 15px #38e3be; }
    button.playing { box-shadow: 0 0 20px #38e3be; }

    /* Music card pinned to bottom */
    .card.music {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      max-width: none;
      border-radius: 0;
      box-shadow: 0 -2px 20px #38e3be;
      z-index: 9999;
      padding: 12px 16px;
    }
    .card.music h2 { margin: 0 0 6px 0; }

    /* Visualizer canvases (consistent sizing) */
    .visualizer {
      width: 100%;
      height: 80px;
      display: none;
      margin-top: 8px;
      background: #111;
    }

    /* Controls layout and styling */
    .controls-top {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }
    .controls-bottom {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
    }
    #themeSelector {
      border-radius: 20px;
      padding: 6px 12px;
      border: 2px solid #38e3be;
      background: rgba(255,255,255,0.85);
      font-family: "Exo 2", sans-serif;
      cursor: pointer;
      transition: 0.3s;
    }
    #themeSelector:hover { box-shadow: 0 0 10px #38e3be; }
    .controls-bottom button {
      border-radius: 20px;
      padding: 6px 14px;
      border: 2px solid #38e3be;
      background: rgba(255,255,255,0.2);
      cursor: pointer;
      transition: 0.3s;
    }
    .controls-bottom button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px #38e3be;
    }

    /* Sticky notes (appear on "seal") and are draggable */
    .sticky-note {
      position: fixed;
      bottom: 100px; /* above the music bar */
      left: 10px;
      background: #fff9c4;
      color: #333;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
      font-family: "Exo 2", sans-serif;
      cursor: move; /* indicates draggable */
      z-index: 10000;
      max-width: 220px;
      display: none;
      user-select: none;
    }
    .sticky-note#note2 { left: 240px; }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 15px;
      max-width: 420px;
    }

    /* No animations toggle: disable float/flip only, keep hover effects */
    .no-animations .card { animation: none !important; transition: none !important; }
    .no-animations .card.flip { transform: none !important; }

    /* Responsive */
    @media (max-width: 768px) {
      .cards-container { grid-template-columns: 1fr; }
      .card img { width: 150px; height: 150px; }
    }
  </style>
</head>
<body>
  <div class="fluidjumbo">
    <h1>The (maybe detective) seal's portfolio</h1>
    <p>About me is below</p>
  </div>

  <div class="cards-container">
    <div class="card race">
      <h2>Racing / Driving / Cars</h2>
      <p>I like going racing like vroom vroom.</p>
      <div class="img-wrap"><img src="https://upload.wikimedia.org/wikipedia/commons/5/57/Global_MX-5_Cup_car_-_Tokyo_Auto_Salon_2015.jpg" alt="car"></div>
      <button class="open-modal" data-modal="modal1">Racing series I like</button>
    </div>

    <div class="card seal">
      <h2>Seals</h2>
      <p>If you can't tell, I like seals :)</p>
      <div class="img-wrap"><img src="niko.webp" alt="seal"></div>
      <button class="open-modal" data-modal="modal2">Seals of choosing</button>
    </div>

    <div class="card seal2">
      <h2>Seal 2</h2>
      <p>Seals and seals and seals...</p>
      <div class="img-wrap"><img src="niko.webp" alt="seal2"></div>
      <button class="open-modal" data-modal="modal3">Seals :)</button>
    </div>
  </div>

  <!-- Music card pinned to bottom -->
  <div class="card music">
    <h2>Music</h2>
    <div id="playlist-container">
      <div class="controls-top">
        <select id="themeSelector" title="Visualizer theme">
          <option value="bars">Bars</option>
          <option value="circle">Circle</option>
          <option value="wave">Wave</option>
        </select>
      </div>

      <!-- Playlist buttons + canvases (audio elements declared at bottom) -->
      <button class="play-btn" data-audio="song1" data-vis="viz1">Finale</button>
      <canvas class="visualizer" id="viz1"></canvas>

      <button class="play-btn" data-audio="song2" data-vis="viz2">Funky Town</button>
      <canvas class="visualizer" id="viz2"></canvas>

      <button class="play-btn" data-audio="song3" data-vis="viz3">Nope</button>
      <canvas class="visualizer" id="viz3"></canvas>

      <button class="play-btn" data-audio="song5" data-vis="viz5">Mirrors demo</button>
      <canvas class="visualizer" id="viz5"></canvas>

      <!-- Secret track will be injected here after typing "seal" -->

      <div class="controls-bottom">
        <button id="prevBtn">Prev</button>
        <button id="nextBtn">Next</button>
        <button id="shuffleBtn">Shuffle</button>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="modal1" class="modal">
    <div class="modal-content">
      <p>Some racing thingys i like (series) are Nascar (NO ITS NOT JUST CARS GOING IN CIRCLES) F1, GT3, WEC, WRC, Endurance etc etc rx7 fc</p>
      <button class="close-modal">Close</button>
    </div>
  </div>
  <div id="modal2" class="modal">
    <div class="modal-content">
      <p>So like theres many species of seals, like the um, the um erm um species. Harp Ringed Harbor, Monk, theres more if u want to search it up</p>
      <button class="close-modal">Close</button>
    </div>
  </div>
  <div id="modal3" class="modal">
    <div class="modal-content">
      <p>niko (in my opinion) is the best seal, followed by kroshik, then yuki, then yo-chan, but all seals are COOL</p>
      <button class="close-modal">Close</button>
    </div>
  </div>

  <!-- Audio elements -->
  <audio id="song1" src="finale.mp3" preload="auto"></audio>
  <audio id="song2" src="funky.mp3" preload="auto"></audio>
  <audio id="song3" src="nope.mp3" preload="auto"></audio>
  <audio id="song5" src="mirror.mp3" preload="auto"></audio>

  <!-- Sticky notes -->
  <div class="sticky-note" id="note1">Made by TheDetectiveSeal</div>
  <div class="sticky-note" id="note2">i like seals</div>

  <!-- No animations toggle -->
  <button id="toggle-animations" style="position:fixed;top:10px;right:10px;z-index:10001;">No animations</button>

  <script>
  (() => {
    // Elements
    const playlistContainer = document.getElementById("playlist-container");
    const themeSelector = document.getElementById("themeSelector");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const playBtns = Array.from(document.querySelectorAll(".play-btn"));

    // Audio graph
    let audioCtx = null;
    const sources = new Map(); // audioEl -> { src, analyser }
    let currentIndex = -1;
    let currentAudio = null;
    let currentCanvas = null;
    let drawRaf = null;

    // Ensure AudioContext
    async function ensureCtx() {
      if (!audioCtx || audioCtx.state === "closed") {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === "suspended") {
        try { await audioCtx.resume(); } catch {}
      }
      return audioCtx;
    }

    // Prepare canvas to device ratio
    function prepareCanvas(canvas) {
      const ctx = canvas.getContext("2d");
      const ratio = window.devicePixelRatio || 1;
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      canvas.width = Math.max(1, Math.floor(w * ratio));
      canvas.height = Math.max(1, Math.floor(h * ratio));
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      return ctx;
    }

    // Stop visualizer loop and hide canvases
    function stopVisualizer() {
      if (drawRaf) cancelAnimationFrame(drawRaf);
      drawRaf = null;
      document.querySelectorAll(".visualizer").forEach(c => {
        c.style.display = "none";
        const ctx = c.getContext("2d");
        if (ctx) ctx.clearRect(0, 0, c.width, c.height);
      });
      document.querySelectorAll(".play-btn").forEach(b => b.classList.remove("playing"));
    }

    // Stop audio
    function stopCurrentAudio() {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.onended = null;
      }
      currentAudio = null;
      currentCanvas = null;
    }

    function stopAll() {
      stopVisualizer();
      stopCurrentAudio();
    }

    // Visualizer drawing with themes:
    // - Bars: standard
    // - Circle: ring with radial bars
    // - Wave: less aggressive amplitude
    function drawVisualizer(analyser, canvas) {
      const ctx = prepareCanvas(canvas);
      const bufferLength = analyser.frequencyBinCount;
      const freqData = new Uint8Array(bufferLength);
      const timeData = new Uint8Array(bufferLength);

      function loop() {
        drawRaf = requestAnimationFrame(loop);
        const theme = themeSelector.value;

        if (theme === "wave") {
          analyser.getByteTimeDomainData(timeData);
        } else {
          analyser.getByteFrequencyData(freqData);
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (theme === "bars") {
          const barWidth = Math.max(4, Math.floor(canvas.width / bufferLength) - 2);
          let x = 0;
          for (let i = 0; i < bufferLength; i++) {
            const h = (freqData[i] / 255) * canvas.height;
            ctx.fillStyle = "#38e3be";
            ctx.fillRect(x, canvas.height - h, barWidth, h);
            x += barWidth + 2;
          }
        } else if (theme === "circle") {
          const radius = Math.min(canvas.width, canvas.height) / 4;
          // Base ring
          ctx.beginPath();
          ctx.arc(canvas.width / 2, canvas.height / 2, radius, 0, Math.PI * 2);
          ctx.strokeStyle = "#38e3be";
          ctx.lineWidth = 3;
          ctx.stroke();

          // Radial bars
          const angleStep = (Math.PI * 2) / bufferLength;
          const cx = canvas.width / 2;
          const cy = canvas.height / 2;
          for (let i = 0; i < bufferLength; i++) {
            const value = freqData[i];
            const barLen = (value / 255) * (radius * 0.7); // length scaled with radius
            const angle = i * angleStep;
            const x1 = cx + Math.cos(angle) * radius;
            const y1 = cy + Math.sin(angle) * radius;
            const x2 = cx + Math.cos(angle) * (radius + barLen);
            const y2 = cy + Math.sin(angle) * (radius + barLen);
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = "#38e3be";
            ctx.lineWidth = 2;
            ctx.stroke();
          }
        } else if (theme === "wave") {
          ctx.beginPath();
          ctx.moveTo(0, canvas.height / 2);
          for (let i = 0; i < bufferLength; i++) {
            const x = (i / bufferLength) * canvas.width;
            const y = canvas.height / 2 + (timeData[i] - 128) * 0.45; // smoother, less aggressive
            ctx.lineTo(x, y);
          }
          ctx.strokeStyle = "#38e3be";
          ctx.lineWidth = 2;
          ctx.stroke();
        }
      }
      loop();
    }

    // Play by index in playlist array
    async function playIndex(index) {
      await ensureCtx();

      if (index < 0 || index >= playBtns.length) return;

      const btn = playBtns[index];
      const audioEl = document.getElementById(btn.dataset.audio);
      const canvas = document.getElementById(btn.dataset.vis);

      // Stop previous
      stopAll();

      // Create source once
      if (!sources.has(audioEl)) {
        const src = audioCtx.createMediaElementSource(audioEl);
        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        src.connect(analyser);
        analyser.connect(audioCtx.destination);
        sources.set(audioEl, { src, analyser });
      }

      // Play and visualize
      canvas.style.display = "block";
      btn.classList.add("playing");
      try { await audioEl.play(); } catch (e) { console.error("Playback error:", e); return; }

      currentIndex = index;
      currentAudio = audioEl;
      currentCanvas = canvas;

      const { analyser } = sources.get(audioEl);
      drawVisualizer(analyser, canvas);

      // Auto-advance to next track
      audioEl.onended = () => {
        const next = currentIndex + 1;
        if (next < playBtns.length) {
          playIndex(next);
        } else {
          stopAll();
          currentIndex = -1;
        }
      };
    }

    // Button click handlers (playlist entries)
    playBtns.forEach((btn, i) => {
      btn.addEventListener("click", () => {
        if (currentIndex === i) {
          // Toggle off
          stopAll();
          currentIndex = -1;
        } else {
          playIndex(i);
        }
      });
    });

    // Controls: prev/next/shuffle (bottom of card)
    prevBtn.addEventListener("click", () => {
      if (currentIndex <= 0) return;
      playIndex(currentIndex - 1);
    });
    nextBtn.addEventListener("click", () => {
      if (currentIndex < 0) {
        playIndex(0);
      } else {
        const next = currentIndex + 1;
        if (next < playBtns.length) playIndex(next);
      }
    });
    shuffleBtn.addEventListener("click", () => {
      const random = Math.floor(Math.random() * playBtns.length);
      playIndex(random);
    });

    // Live theme switching: re-render current visualizer with new theme
    themeSelector.addEventListener("change", () => {
      if (!currentAudio || !currentCanvas) return;
      const { analyser } = sources.get(currentAudio);
      if (drawRaf) cancelAnimationFrame(drawRaf);
      drawVisualizer(analyser, currentCanvas);
    });

    // Secret code: "seal" unlocks sticky notes and Smooth Operator (smooth.mp3)
    let typed = "";
    window.addEventListener("keydown", (e) => {
      typed += e.key.toLowerCase();
      if (typed.length > 10) typed = typed.slice(-10);
      if (typed.includes("seal")) {
        // Show sticky notes
        document.querySelectorAll(".sticky-note").forEach(n => n.style.display = "block");

        // Add hidden track if not already present
        if (!document.getElementById("smooth-audio")) {
          // Create audio element
          const audioEl = document.createElement("audio");
          audioEl.id = "smooth-audio";
          audioEl.src = "smooth.mp3";
          audioEl.preload = "auto";
          document.body.appendChild(audioEl);

          // Create UI button + canvas in playlist order
          const btn = document.createElement("button");
          btn.className = "play-btn";
          btn.dataset.audio = "smooth-audio";
          btn.dataset.vis = "viz-smooth";
          btn.textContent = "Smooth Operator";

          const canvas = document.createElement("canvas");
          canvas.className = "visualizer";
          canvas.id = "viz-smooth";

          // Insert before controls-bottom (to keep controls at bottom)
          const controlsBottom = document.querySelector(".controls-bottom");
          playlistContainer.insertBefore(btn, controlsBottom);
          playlistContainer.insertBefore(canvas, controlsBottom);

          // Register and wire up
          playBtns.push(btn);
          btn.addEventListener("click", () => {
            const idx = playBtns.indexOf(btn);
            if (currentIndex === idx) {
              stopAll();
              currentIndex = -1;
            } else {
              playIndex(idx);
            }
          });
        }
      }
    });

    // Modals
    document.querySelectorAll('.open-modal').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.modal;
        const m = document.getElementById(id);
        if (m) m.style.display = 'flex';
      });
    });
    document.querySelectorAll('.close-modal').forEach(btn => {
      btn.addEventListener('click', () => {
        const m = btn.closest('.modal');
        if (m) m.style.display = 'none';
      });
    });
    window.addEventListener('click', ev => {
      if (ev.target.classList.contains('modal')) {
        ev.target.style.display = 'none';
      }
    });

    // No animations toggle: disable float/flip only; keep hovers
    const toggleBtn = document.getElementById('toggle-animations');
    toggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('no-animations');
    });
  })();
  </script>

  <!-- Draggable sticky notes -->
  <script>
  (() => {
    function makeDraggable(note) {
      let isDragging = false;
      let offsetX = 0, offsetY = 0;

      note.addEventListener("mousedown", e => {
        isDragging = true;
        offsetX = e.clientX - note.offsetLeft;
        offsetY = e.clientY - note.offsetTop;
        note.style.position = "fixed";
        note.style.zIndex = 10001;
      });

      window.addEventListener("mousemove", e => {
        if (!isDragging) return;
        note.style.left = (e.clientX - offsetX) + "px";
        note.style.top = (e.clientY - offsetY) + "px";
      });

      window.addEventListener("mouseup", () => {
        isDragging = false;
        note.style.zIndex = 10000;
      });
    }

    document.querySelectorAll(".sticky-note").forEach(makeDraggable);
  })();
  </script>

  <!-- Seal follower (single instance, respects no-animations) -->
  <script>
  (() => {
    if (document.getElementById('seal-follow')) return;
    const seal = document.createElement('img');
    seal.id = 'seal-follow';
    seal.src = 'niko.webp';
    seal.style.position = 'fixed';
    seal.style.top = '0px';
    seal.style.left = '0px';
    seal.style.width = '50px';
    seal.style.height = '50px';
    seal.style.borderRadius = '50%';
    seal.style.pointerEvents = 'none';
    seal.style.zIndex = '10000';
    seal.style.transform = 'translate3d(0px, 0px, 0px)';
    document.body.appendChild(seal);

    let sx = 0, sy = 0, tx = 0, ty = 0;
    const speed = 0.1;
    window.addEventListener('mousemove', e => { tx = e.clientX - 25; ty = e.clientY - 25; });
    function animateSeal() {
      // Respect no-animations: stop movement but keep the element visible
      if (!document.body.classList.contains('no-animations')) {
        sx += (tx - sx) * speed;
        sy += (ty - sy) * speed;
        seal.style.transform = `translate3d(${sx}px, ${sy}px, 0)`;
      }
      requestAnimationFrame(animateSeal);
    }
    animateSeal();
  })();
  </script>
</body>
</html>
