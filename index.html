<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detectified</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@100;400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: "Exo 2", sans-serif;
      background: url("https://i.imgur.com/ol1MfVj.gif") no-repeat center center fixed;
      background-size: cover;
      color: black;
      cursor: url('https://i.imgur.com/4b7KkzM.png') 16 16, auto;
    }
    .fluidjumbo {
      background-color: #38e3be2f;
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 25px;
      text-align: center;
      margin: 20px auto;
      max-width: 90%;
    }
    .cards-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      justify-items: center;
      padding: 10px;
    }
    .card {
      background: linear-gradient(rgba(229, 235, 234, 0.5), rgba(143, 143, 143, 0.5));
      border: 3px inset #ffffff9a;
      border-radius: 25px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      padding: 15px;
      box-shadow: 0 0 30px #38e3be;
      backdrop-filter: blur(5px);
      position: relative;
    }
    .img-wrap { display: inline-block; transition: transform 0.4s ease; }
    .img-wrap:hover { transform: rotate(360deg) scale(1.1); }
    .card img { width: 200px; height: 200px; border-radius: 30px; display: block; }

    button {
      display: block;
      margin: 8px auto;
      border-radius: 25px;
      padding: 8px 20px;
      border: 2px solid #38e3be;
      background: rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: 0.3s ease;
    }
    button:hover { transform: scale(1.05); box-shadow: 0 0 15px #38e3be; }
    button.playing { box-shadow: 0 0 20px #38e3be; }

    /* Visualizer canvases (consistent sizing) */
    .visualizer {
      width: 100%;
      height: 80px;
      display: none;
      margin-top: 8px;
      background: #111;
    }

    /* Controls row */
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .controls select {
      border-radius: 20px;
      padding: 6px 10px;
      border: 2px solid #38e3be;
      background: rgba(255, 255, 255, 0.7);
    }

    /* Sticky notes (hidden until "seal") */
    .sticky-note {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #fff9c4;
      color: #333;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
      font-family: "Exo 2", sans-serif;
      cursor: pointer;
      z-index: 10000;
      max-width: 220px;
      display: none;
    }
    .sticky-note#note2 { left: 240px; }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 15px;
      max-width: 420px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .cards-container { grid-template-columns: 1fr; }
      .card img { width: 150px; height: 150px; }
    }
  </style>
</head>
<body>
  <div class="fluidjumbo">
    <h1>The (maybe detective) seal's portfolio</h1>
    <p>About me is below</p>
  </div>

  <div class="cards-container">
    <div class="card race">
      <h2>Racing / Driving / Cars</h2>
      <p>I like going racing like vroom vroom.</p>
      <div class="img-wrap"><img src="https://upload.wikimedia.org/wikipedia/commons/5/57/Global_MX-5_Cup_car_-_Tokyo_Auto_Salon_2015.jpg" alt="car"></div>
      <button class="open-modal" data-modal="modal1">Racing series I like</button>
    </div>

    <div class="card seal">
      <h2>Seals</h2>
      <p>If you can't tell, I like seals :)</p>
      <div class="img-wrap"><img src="niko.webp" alt="seal"></div>
      <button class="open-modal" data-modal="modal2">Seals of choosing</button>
    </div>

    <div class="card seal2">
      <h2>Seal 2</h2>
      <p>Seals and seals and seals...</p>
      <div class="img-wrap"><img src="niko.webp" alt="seal2"></div>
      <button class="open-modal" data-modal="modal3">Seals :)</button>
    </div>

    <div class="card music">
      <h2>Music</h2>
      <p>Funny music I like</p>

      <div id="playlist-container">
        <div class="controls">
          <select id="themeSelector" title="Visualizer theme">
            <option value="bars">Bars</option>
            <option value="circle">Circle</option>
            <option value="wave">Wave</option>
          </select>
          <button id="prevBtn">Prev</button>
          <button id="nextBtn">Next</button>
          <button id="shuffleBtn">Shuffle</button>
        </div>

        <!-- Playlist items: button + canvas pair; audio tags at bottom -->
        <button class="play-btn" data-audio="song1" data-vis="viz1">Finale</button>
        <canvas class="visualizer" id="viz1"></canvas>

        <button class="play-btn" data-audio="song2" data-vis="viz2">Funky Town</button>
        <canvas class="visualizer" id="viz2"></canvas>

        <button class="play-btn" data-audio="song3" data-vis="viz3">Nope</button>
        <canvas class="visualizer" id="viz3"></canvas>

        <button class="play-btn" data-audio="song5" data-vis="viz5">Mirrors demo</button>
        <canvas class="visualizer" id="viz5"></canvas>

        <!-- Secret track (added when typing "seal") will appear here -->
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="modal1" class="modal"><div class="modal-content"><p>Some racing thingys i like (series) are Nascar (NO ITS NOT JUST CARS GOING IN CIRCLES) F1, GT3, WEC, WRC, Endurance etc etc rx7 fc</p><button class="close-modal">Close</button></div></div>
  <div id="modal2" class="modal"><div class="modal-content"><p>So like theres many species of seals, like the um, the um erm um species. Harp Ringed Harbor, Monk, theres more if u want to search it up</p><button class="close-modal">Close</button></div></div>
  <div id="modal3" class="modal"><div class="modal-content"><p>niko (in my opinion) is the best seal, followed by kroshik, then yuki, then yo-chan, but all seals are COOL</p><button class="close-modal">Close</button></div></div>

  <!-- Audio elements (kept at bottom to ensure they exist for sources) -->
  <audio id="song1" src="finale.mp3" preload="auto"></audio>
  <audio id="song2" src="funky.mp3" preload="auto"></audio>
  <audio id="song3" src="nope.mp3" preload="auto"></audio>
  <audio id="song5" src="mirror.mp3" preload="auto"></audio>

  <!-- Sticky notes -->
  <div class="sticky-note" id="note1">Made by TheDetectiveSeal</div>
  <div class="sticky-note" id="note2">i like seals</div>

  <script>
  (() => {
    // Elements
    const playlistContainer = document.getElementById("playlist-container");
    const themeSelector = document.getElementById("themeSelector");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const playBtns = Array.from(document.querySelectorAll(".play-btn"));

    // Audio graph
    let audioCtx = null;
    const sources = new Map(); // audioEl -> { src, analyser }
    let currentIndex = -1;
    let currentAudio = null;
    let currentCanvas = null;
    let drawRaf = null;

    async function ensureCtx() {
      if (!audioCtx || audioCtx.state === "closed") {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === "suspended") {
        try { await audioCtx.resume(); } catch {}
      }
      return audioCtx;
    }

    function prepareCanvas(canvas) {
      const ctx = canvas.getContext("2d");
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      return ctx;
    }

    function stopVisualizer() {
      if (drawRaf) cancelAnimationFrame(drawRaf);
      drawRaf = null;
      document.querySelectorAll(".visualizer").forEach(c => {
        c.style.display = "none";
        const ctx = c.getContext("2d");
        if (ctx) ctx.clearRect(0, 0, c.width, c.height);
      });
      document.querySelectorAll(".play-btn").forEach(b => b.classList.remove("playing"));
    }

    function stopCurrentAudio() {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.onended = null;
      }
      currentAudio = null;
      currentCanvas = null;
    }

    function stopAll() {
      stopVisualizer();
      stopCurrentAudio();
    }

    function drawVisualizer(analyser, canvas) {
      const ctx = prepareCanvas(canvas);
      const bufferLength = analyser.frequencyBinCount;
      const freqData = new Uint8Array(bufferLength);
      const timeData = new Uint8Array(bufferLength);

      function loop() {
        drawRaf = requestAnimationFrame(loop);
        const theme = themeSelector.value;

        if (theme === "wave") {
          analyser.getByteTimeDomainData(timeData);
        } else {
          analyser.getByteFrequencyData(freqData);
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (theme === "bars") {
          const barWidth = Math.max(4, Math.floor(canvas.width / bufferLength) - 2);
          let x = 0;
          for (let i = 0; i < bufferLength; i++) {
            const h = (freqData[i] / 255) * canvas.height;
            ctx.fillStyle = "#38e3be";
            ctx.fillRect(x, canvas.height - h, barWidth, h);
            x += barWidth + 2;
          }
        } else if (theme === "circle") {
          const radius = Math.min(canvas.width, canvas.height) / 4;
          const boost = (freqData[0] || 0) / 255 * radius;
          ctx.beginPath();
          ctx.arc(canvas.width / 2, canvas.height / 2, radius + boost, 0, Math.PI * 2);
          ctx.strokeStyle = "#38e3be";
          ctx.lineWidth = 4;
          ctx.stroke();
        } else if (theme === "wave") {
          ctx.beginPath();
          ctx.moveTo(0, canvas.height / 2);
          for (let i = 0; i < bufferLength; i++) {
            const x = (i / bufferLength) * canvas.width;
            const y = (timeData[i] - 128) + canvas.height / 2;
            ctx.lineTo(x, y);
          }
          ctx.strokeStyle = "#38e3be";
          ctx.lineWidth = 2;
          ctx.stroke();
        }
      }
      loop();
    }

    async function playIndex(index) {
      await ensureCtx();

      // Bounds check
      if (index < 0 || index >= playBtns.length) return;

      // Resolve elements
      const btn = playBtns[index];
      const audioEl = document.getElementById(btn.dataset.audio);
      const canvas = document.getElementById(btn.dataset.vis);

      // Stop previous
      stopAll();

      // Create source once
      if (!sources.has(audioEl)) {
        const src = audioCtx.createMediaElementSource(audioEl);
        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256; // Higher resolution
        src.connect(analyser);
        analyser.connect(audioCtx.destination);
        sources.set(audioEl, { src, analyser });
      }

      // Play and visualize
      canvas.style.display = "block";
      btn.classList.add("playing");
      try { await audioEl.play(); } catch (e) { console.error("Playback error:", e); return; }

      currentIndex = index;
      currentAudio = audioEl;
      currentCanvas = canvas;

      const { analyser } = sources.get(audioEl);
      drawVisualizer(analyser, canvas);

      // Auto-advance to next track
      audioEl.onended = () => {
        const next = currentIndex + 1;
        if (next < playBtns.length) {
          playIndex(next);
        } else {
          stopAll();
          currentIndex = -1;
        }
      };
    }

    // Button click handlers (playlist entries)
    playBtns.forEach((btn, i) => {
      btn.addEventListener("click", () => {
        if (currentIndex === i) {
          // Toggle off
          stopAll();
          currentIndex = -1;
        } else {
          playIndex(i);
        }
      });
    });

    // Controls: prev/next/shuffle
    prevBtn.addEventListener("click", () => {
      if (currentIndex <= 0) return;
      playIndex(currentIndex - 1);
    });
    nextBtn.addEventListener("click", () => {
      if (currentIndex < 0) {
        playIndex(0);
      } else {
        const next = currentIndex + 1;
        if (next < playBtns.length) playIndex(next);
      }
    });
    shuffleBtn.addEventListener("click", () => {
      const random = Math.floor(Math.random() * playBtns.length);
      playIndex(random);
    });

    // Live theme switching: re-render current visualizer with new theme
    themeSelector.addEventListener("change", () => {
      if (!currentAudio || !currentCanvas) return;
      const { analyser } = sources.get(currentAudio);
      // Restart draw loop with new theme
      if (drawRaf) cancelAnimationFrame(drawRaf);
      drawVisualizer(analyser, currentCanvas);
    });

    // Secret code: "seal" unlocks sticky notes and Smooth Operator
    let typed = "";
    window.addEventListener("keydown", (e) => {
      typed += e.key.toLowerCase();
      if (typed.length > 10) typed = typed.slice(-10);
      if (typed.includes("seal")) {
        // Reveal sticky notes
        document.querySelectorAll(".sticky-note").forEach(n => n.style.display = "block");

        // Add hidden track if not present
        if (!document.getElementById("smooth-audio")) {
          // Audio
          const audioEl = document.createElement("audio");
          audioEl.id = "smooth-audio";
          audioEl.src = "smooth.mp3";
          audioEl.preload = "auto";
          document.body.appendChild(audioEl); // Keep audio elements light in DOM

          // UI in playlist
          const btn = document.createElement("button");
          btn.className = "play-btn";
          btn.dataset.audio = "smooth-audio";
          btn.dataset.vis = "viz-smooth";
          btn.textContent = "Smooth Operator";
          const canvas = document.createElement("canvas");
          canvas.className = "visualizer";
          canvas.id = "viz-smooth";

          playlistContainer.appendChild(btn);
          playlistContainer.appendChild(canvas);

          // Register in playlist order
          playBtns.push(btn);

          // Hook play
          btn.addEventListener("click", () => {
            const idx = playBtns.indexOf(btn);
            if (currentIndex === idx) {
              stopAll();
              currentIndex = -1;
            } else {
              playIndex(idx);
            }
          });
        }
      }
    });

    // Modals
    document.querySelectorAll('.open-modal').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.modal;
        const m = document.getElementById(id);
        if (m) m.style.display = 'flex';
      });
    });
    document.querySelectorAll('.close-modal').forEach(btn => {
      btn.addEventListener('click', () => {
        const m = btn.closest('.modal');
        if (m) m.style.display = 'none';
      });
    });
    window.addEventListener('click', ev => {
      if (ev.target.classList.contains('modal')) {
        ev.target.style.display = 'none';
      }
    });
  })();
  </script>

  <!-- Optional seal follower (kept, single instance) -->
  <script>
  (() => {
    if (document.getElementById('seal-follow')) return;
    const seal = document.createElement('img');
    seal.id = 'seal-follow';
    seal.src = 'niko.webp';
    seal.style.position = 'fixed';
    seal.style.top = '0px';
    seal.style.left = '0px';
    seal.style.width = '50px';
    seal.style.height = '50px';
    seal.style.borderRadius = '50%';
    seal.style.pointerEvents = 'none';
    seal.style.zIndex = '10000';
    seal.style.transform = 'translate3d(0px, 0px, 0px)';
    document.body.appendChild(seal);

    let sx = 0, sy = 0, tx = 0, ty = 0;
    const speed = 0.1;
    window.addEventListener('mousemove', e => { tx = e.clientX - 25; ty = e.clientY - 25; });
    function animateSeal() {
      sx += (tx - sx) * speed;
      sy += (ty - sy) * speed;
      seal.style.transform = `translate3d(${sx}px, ${sy}px, 0)`;
      requestAnimationFrame(animateSeal);
    }
    animateSeal();
  })();
  </script>
</body>
</html>
